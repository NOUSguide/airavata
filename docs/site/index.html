<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="./img/favicon.ico">

        <title>My Docs</title>

        <link href="./css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="./css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="./css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="./css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body class="homepage">

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            

            <!-- Main title -->
            <a class="navbar-brand" href=".">My Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            

            
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#django-polla">Django Polla</a></li>
        
            <li><a href="#getting-started">Getting started</a></li>
        
            <li><a href="#models">Models</a></li>
        
            <li><a href="#views">Views</a></li>
        
            <li><a href="#extras">Extras</a></li>
        
            <li><a href="#todo">ToDo</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="django-polla">Django Polla</h1>
<p>Python 2.7 <a href="http://jenkins.lasolution.be/view/Levit/job/Polla/PYTHON=System-CPython-2.7"><img alt="Build Status" src="http://jenkins.lasolution.be/buildStatus/icon?job=Polla/PYTHON=System-CPython-2.7" /></a>
Python 3.2 <a href="http://jenkins.lasolution.be/view/Levit/job/Polla/PYTHON=System-CPython-3.2/"><img alt="Build Status" src="http://jenkins.lasolution.be/buildStatus/icon?job=Polla/PYTHON=System-CPython-3.2" /></a>
Python 3.4 <a href="http://jenkins.lasolution.be/view/Levit/job/Polla/PYTHON=CPython-3.4/"><img alt="Build Status" src="http://jenkins.lasolution.be/buildStatus/icon?job=Polla/PYTHON=CPython-3.4" /></a></p>
<p>Docs [<img alt="Docs status" src="https://readthedocs.org/projects/django-polla/badge/?version=latest" /></p>
<p>Polla (πολλά - in Greek "lots of / multi") is a Django 1.8+ library that allows you to hosts multiple dynamic sites running on a single Django instance/db.</p>
<p>I have been using a customized version of <a href="https://bitbucket.org/uysrc/django-dynamicsites/overview">dynamicsites</a> for a while now. But with the new features from Django 1.7 and 1.8, there exists another simpler, and more pythonesque IMHO, way to achieve the same results. Polla is an attempt at that <em>other</em> way.</p>
<h2 id="getting-started">Getting started</h2>
<h3 id="install">Install</h3>
<p><code>pip install django_polla</code></p>
<h3 id="configure">Configure</h3>
<p>Add <code>polla</code> and <code>django.contrib.sites</code> to your installed apps</p>
<pre><code>## settings.py
INSTALLED_APPS = [
    ...
    'django.contrib.sites',
    'polla',
]
</code></pre>

<p><em>Make sure SITE_ID in not set in</em> <code>settings.py</code></p>
<h3 id="allowed_hosts">ALLOWED_HOSTS</h3>
<p>Polla provides two wrapper classes to fetch <code>ALLOWED_HOSTS</code> from the database instead of hard-coding them.
These two classes were largely inspired by (read mostly copied from) <a href="https://github.com/kezabelle/django-allowedsites">kezabelle's django-allowedsites</a>.
Namely they are <code>polla.utils.AllowedSites</code> and <code>polla.utils.CachedAllowedSites</code>. Use either of those in your settings.py</p>
<pre><code>## settings.py
from polla.utils import AllowedSites
ALLOWED_HOSTS = AllowedSites()
</code></pre>

<h4 id="cache-invalidation">Cache invalidation</h4>
<p>If you are planning on using CachedAllowedSites, don't forget to register cache invalidation signals in your <a href="https://docs.djangoproject.com/en/1.8/ref/applications/#django.apps.AppConfig.ready">AppConfig</a>.</p>
<pre><code>## apps.py
from django.apps import AppConfig
from polla.utils import register_signals

class MyAppConfig(AppConfig):
  name = 'my_app'
  verbose_name = &quot;My app&quot;

  def ready(self):
        from django.contrib.sites.models import Site
        from polla.models import SiteAlias
        for model in [Site, SiteAlias]:
            register_signals(model)

## __init__.py
default_app_config = 'my_app.apps.MyAppConfig'
</code></pre>

<p>Also note that cache is supposed to be shared among Django instances in order for this process to work. Read <a href="https://docs.djangoproject.com/en/1.8/topics/cache/#setting-up-the-cache">more about cache</a></p>
<h3 id="set-the-domain-for-your-primary-site">Set the domain for your primary site</h3>
<p>Once <code>django.contrib.sites</code> is added to your <code>settings.py</code> Django won't let you access your website unless one of teh following is true:</p>
<ul>
<li><code>SITE_ID</code> is also set in your <code>settings.py</code> (which we don't want to do since this library is for hosting <em>multiple dynamic</em> sites)</li>
<li><code>DEBUG</code> is set to <code>True</code> which is ok for dev but not for live servers</li>
<li>Django finds a <code>Site</code> (or a <code>SiteAlias</code> with Polla) corresponding to the <code>host</code> you are requesting</li>
</ul>
<p>In order to set the correct domain on the first site in your database, Polla provides a management command. Simply run</p>
<p><code>python manage.py setprimarydomain</code></p>
<h2 id="models">Models</h2>
<p>Polla provides a <code>SiteAlias</code> model which allows you to create domain aliases. Even though serving the same content from different hostnames is not advisable it can be useful in at least 2 cases:</p>
<ul>
<li>local dev with live-ish data: simply create an alias to your existing site</li>
<li>BitBucket-style case where main domain/address https://bitbucket.org/levit_scs/django-polla has a convenience alias on http://bb.levit.be/django-polla</li>
</ul>
<h2 id="views">Views</h2>
<p>Polla provides a mixin for filtering views. Originally <code>SingleObjectMixin</code> and <code>MultipleObjectMixin</code> subclasses but feel free to use it on any View which provides a <code>get_queryset</code> method.</p>
<p><code>SiteFilteredViewMixin</code> filters <code>get_queryset</code> by the current site. By default <code>SiteFilteredViewMixin</code> looks for a <code>site</code> field but you can override with the <code>site_field</code> parameter.</p>
<pre><code>from django.views.generic import DetailView, ListView
from polla.views import SiteFilteredViewMixin

from .models import MyModel


class MyModelListView(SiteFilteredViewMixin, ListView):

  model = MyModel


class MyModelDetailView(SiteFilteredViewMixin, DetailView):

  model = MyModel
  site_field = 'base_site'
</code></pre>

<h2 id="extras">Extras</h2>
<p>As serving multiple dynamic sites is highly dependent on the requested host. Polla adds validators to <code>Site</code> and <code>SiteAlias</code> in order to make sure domain names are unique.</p>
<h2 id="todo">ToDo</h2>
<ul>
<li>allow different name_based urlpatterns to be applied depending on the requested host</li>
<li>allow to use a different set of temples depending on the requested host</li>
<li>allow serving different static files depending on the requested host</li>
<li>improve this doc</li>
</ul>
<p>This project is licensed under the <a href="http://bb.levit.be/django-polla/src/default/LICENSE.txt">BSD 2-Clause License</a></p>
</div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="./js/bootstrap-3.0.3.min.js"></script>
        <script src="./js/prettify-1.0.min.js"></script>
        <script src="./js/highlight.pack.js"></script>
        <script src="./js/base.js"></script>
    </body>
</html>